CODE SEGMENT PARA PUBLIC 'CODE'
	ASSUME	CS:CODE,DS:DATAS,SS:STOSIK
JMP START
JUMP DB 98,97,95,93,91,90,88,86,84,83,81,79,78,76,74,72,71,69,67,66
	 DB 64,63,61,59,58,56,55,53,52,50,48,47,46,44,43,41,40,38,37,36
	 DB 34,33,32,31,29,28,27,26,25,23,22,21,20,19,18,17,16,15,14,13
	 DB 13,12,11,10,9,9,8,7,7,6,5,5,4,4,3,3,3,2,2,2
	 DB 1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2
	 DB 2,2,3,3,3,4,4,5,5,6,7,7,8,9,9,10,11,12,13,13
	 DB 14,15,16,17,18,19,20,21,22,23,25,26,27,28,29,31,32,33,34,36
	 DB 37,38,40,41,43,44,46,47,48,50,52,53,55,56,58,59,61,63,64,66
	 DB 67,69,71,72,74,76,77,79,81,83,84,86,88,90,91,93,95,96,98,100
START:
	MOV AX,0013H
	INT 10H
	MOV AX,DATAS
	MOV DS,AX

	MOV AX,3D00H
	MOV DX,OFFSET FNAME
	INT 21H
	MOV BX,AX
	MOV AH,3FH
	MOV CX,765
	MOV DX,OFFSET BUF
	INT 21H
	MOV CX,1
	MOV DI,OFFSET BUF
	MOV DX,3C8H
L000:
	MOV AL,CL
	OUT DX,AL
	INC DX
	MOV AL,[DI]
	OUT DX,AL
	MOV AL,[DI+1]
	OUT DX,AL
	MOV AL,[DI+2]
	OUT DX,AL
	DEC DX
	ADD DI,3
	INC CX
	CMP CX,256
	JB  L000
	MOV AX,0A000H
	MOV ES,AX
	MOV AH,3FH
	MOV CX,64000
	MOV DX,OFFSET FNAME
	INT 21H

	MOV DX,3D4H
	MOV AL,0DH
	MOV AH,2
	OUT DX,AX


	MOV DX,0
	XOR AH,AH
L004:
	MOV SI,OFFSET FNAME
	MOV DI,0
	MOV BX,DX
L005:
	PUSH	DI
	MOV AL,0
	ADD DI,AX
	MOV CX,320
	REP MOVSB
	POP DI
	ADD DI,320
	INC BX
	CMP BX,146
	JB  L001
	MOV BX,1
L001:
	CMP DI,64000
	JB  L005

	INC DX
	CMP DX,147
	JB  LLL
	MOV DX,1

	CLD
LLL: MOV AX,0A000H
	MOV ES,AX
	MOV CX,0
	XOR BP,BP
L01:
	MOV AX,320
	MUL CX
	MOV SI,AX
	XOR BX,BX
L02:
	MOV AL,ES:[SI][BX]
	MOV DS:[BP][buf],AL
	INC BP
	INC BX
	CMP BX,100
JNZ L02

	INC CX
	CMP CX,100
JNZ L01

	MOV AX,0A000H
	MOV ES,AX
	XOR AL,AL
	MOV BX,0
L03:
	MOV ES:[BX],AL
	INC BX
	CMP BX,64000
JNE L03


	mov di,90
	MOV AX,50
	MOV XPO,AX
	MOV AL,1
	MOV DIR,AL
MAIN:
	MOV CX,10000
	SLOW : LOOP SLOW
	XOR CH,CH
	MOV CL,cs:[jump][di]
	MOV AL,CL
	ADD AL,100
	MOV PLUS,AL
	XOR BP,BP
L04:
	MOV AX,320
	MUL CX
	MOV SI,AX
	ADD SI,XPO
	XOR BX,BX
L05:
	MOV AL,DS:[BP][BUF]
	MOV ES:[SI][BX],AL
	INC BP
	INC BX
	CMP BX,100
JNZ L05

	INC CL
	CMP CL,PLUS
JNE L04

	MOV AL,DIR
	CMP AL,1
	JE PR
LW: MOV DX,XPO
	DEC DX
	CMP DX,10
	JNE NOLB
	MOV AL,1
	MOV DIR,AL
NOLB: MOV XPO,DX
	JMP NO2
PR: MOV DX,XPO
	INC DX
	CMP DX,220
	JNE NOPB
	XOR AL,AL
	MOV DIR,AL
NOPB: MOV XPO,DX


NO2:INC di
	CMP di,180
	JNE NO
	XOR di,di
NO: IN	AL,60H
	CMP AL,1
	JE quit       ;****  ESCAPE ****
JMP MAIN

QUIT:
	mov ah,1
	int 21h

	STI

	MOV AX,0003H
	INT 10H
	MOV AX,4C00H
	INT 21H

CODE	ENDS

STOSIK SEGMENT PARA STACK 'STACK'
	DB 2048 DUP (?)
STOSIK ENDS

DATAS SEGMENT PARA PUBLIC 'DATA'
	POCZ	DW  0
	PLUS	DB  0
	XPO	DW  0
	DIR	DB  1
	FNAME	DB  '..\files\cat.ARC',0
	BUF	DB  10400 DUP(0)

DATAS	ENDS
END
