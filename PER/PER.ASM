CODE SEGMENT PARA PUBLIC 'CODE'
	ASSUME	CS:CODE,DS:DATAS,SS:STOSIK,ES:LEWEK
JMP START
CUT DB 131,5,10,144,123,86,103,54,110,154,96,85,95,149,80,36,72,122,21,33
	DB 27,14,66,114,112,41,4,43,1,128,7,61,117,133,63,106,160,102,140,30
	DB 76,58,65,69,22,91,113,153,84,81,127,141,64,107,121,47,13,93,59,98
	DB 90,101,156,57,46,79,51,142,158,26,44,9,97,124,68,135,18,126,73,155
	DB 116,74,138,77,60,119,40,16,38,49,3,146,89,29,31,62,53,134,19,137
	DB 28,147,52,50,139,82,145,15,55,71,111,115,148,34,120,143,118,32,88,157
	DB 83,56,70,42,132,99,136,75,24,87,109,6,108,48,17,94,151,35,129,78
	DB 159,20,2,8,12,39,150,11,23,67,152,100,25,125,130,37,105,45,92,104,1,1,1
PC  DB 0
ILE DB 0
START:
MOV AX,0013H
	INT 10H
	MOV AX,DATAS
	MOV DS,AX

	MOV AX,LEWEK
	MOV ES,AX

	MOV AX,3D00H
	MOV DX,OFFSET FNAME
	INT 21H
	MOV BX,AX
	MOV AH,3FH
	MOV CX,765
	MOV DX,OFFSET BUF
	INT 21H
	MOV CX,1
	MOV DI,OFFSET BUF
	MOV DX,3C8H
L000:
	MOV AL,CL
	OUT DX,AL
	INC DX
	MOV AL,[DI]
	OUT DX,AL
	MOV AL,[DI+1]
	OUT DX,AL
	MOV AL,[DI+2]
	OUT DX,AL
	DEC DX
	ADD DI,3
	INC CX
	CMP CX,256
JB  L000

	PUSH DS
	MOV AX,ES
	MOV DS,AX
	MOV AH,3FH
	MOV CX,64000
	MOV DX,8
	INT 21H
	POP DS

	MOV DX,3D4H
	MOV AL,0DH
	MOV AH,2
	OUT DX,AX

	MOV DX,0
	XOR AH,AH

	MOV BX,0   ;  KTORA NOWA LINIA Z LEWKA NA DOL EKR.

	MOV AX,0A000H
	MOV DS,AX  ; NIE AM JEZ DS DO KONCA !!!

MAIN:
	IN  AL,60H
	LEA SI,CS:QUIT
	CMP AL,1
	JNE NO_Q
	JMP SI

NO_Q:
	INC BX
	CMP BX,200
	JNE OK
	XOR BX,BX

OK: PUSH ES
	MOV AX,0A000H
	MOV ES,AX  ; NA RAZIE...

; ******* UP MOVE ******* OD DOLU LICZAC LINIE 0..150 IDA DO 1..151
	MOV AX,320*50
	MOV DI,AX
	MOV SI,AX
	ADD SI,320
	MOV CX,149*320
REP MOVSB



PUSH BX
AGAIN:
; ******* LEFT TO CENTER *******
	MOV BP,50
	MOV BL,CS:PC
	XOR BH,BH
	STD
LEFT:
	MOV CL,CS:CUT[BX]
	XOR CH,CH
	MOV AX,320
	MUL BP
	ADD AX,CX
	MOV DI,AX
	DEC AX
	MOV SI,AX
REP MOVSB
	INC BP
	CMP BP,200
JNE LEFT
	CLD
; ******* RIGHT TO CENTER ******
	MOV BP,50
RIGHT:
	MOV CL,CS:CUT[BX]
	XOR CH,CH
	MOV AX,320
	MUL BP
	ADD AX,320
	SUB AX,CX
	MOV DI,AX
	INC AX
	MOV SI,AX
REP MOVSB
	INC BP
	CMP BP,200
JNE RIGHT

	INC BL
	CMP BL,160
	JNE OK2
	XOR BL,BL
OK2:MOV CS:PC,BL

	XOR AH,AH
	MOV AL,CS:ILE
	INC AL
	MOV CS:ILE,AL
	CMP AL,4
	JNE AGAIN
	XOR AL,AL
	MOV CS:ILE,AL

	POP BX
; ******* UZUPELNIENIE *********
NOWA:
	POP ES
	MOV AX,320
	MUL BX
	MOV SI,AX
	MOV AX,199*320
	MOV DI,AX
	MOV BP,0
NEW:
	MOV AX,ES:[SI][BP]
	MOV DS:[DI][BP][8],AX
	INC BP
	CMP BP,320
JNZ NEW

JMP MAIN

QUIT:
	mov ah,1
	int 21h
	STI
	MOV AX,0003H
	INT 10H
	MOV AX,4C00H
	INT 21H
CODE	ENDS

STOSIK SEGMENT PARA STACK 'STACK'
	DB 2048 DUP (?)
STOSIK ENDS

LEWEK SEGMENT PARA PUBLIC 'LEWEK'
	DB 64000 DUP (?)
LEWEK ENDS

DATAS SEGMENT PARA PUBLIC 'DATA'
	POCZ	DW  0
	FNAME	DB  '..\files\cat.ARC',0
	BUF	DB  800 DUP (?)
DATAS	ENDS
END
